try{Config=require("./config.json")}catch(e){console.log("Goon encountered an error while trying to load the config file, please resolve this issue and restart Goon\n\n"+e.message),process.exit()}function ping(e){return"<@"+e+">"}Config=Config.config;const manifesttrigger=Config.manifesttrigger,reboottrigger=Config.reboottrigger,singlefaxtrigger=Config.singlefaxtrigger,multifaxtrigger=Config.multifaxtrigger,logolink=Config.logolink,version=Config.version,botmaster=Config.botmaster,botid=Config.botid,defaultsudo=[botmaster,botid].concat(Config.sudo),publicfaxchannel=Config.publicfaxchannel,security=ping(Config.security),cargo=ping(Config.cargo),medical=ping(Config.medical),exploration=ping(Config.exploration),science=ping(Config.science),service=ping(Config.service),command=ping(Config.command),faxdir=Config.faxdir,trimImage=require("trim-image"),fs=require("fs"),path=require("path"),nodeHtmlToImage=require("node-html-to-image"),discordie=require("discordie"),axios=require("axios");function CM(e,n){bot.Channels.get(e).sendMessage(n)}function CMU(e,n,o){bot.Channels.get(e).uploadFile(o,o,n)}function validate(e,n,o){return!!n&&(!!e.message.guild&&(!(!e.message||!e.message.content.includes(n))&&(!!o.includes(e.message.author.id)&&(console.log(n+" by "+e.message.author.username),!0))))}bot=new discordie({messageCacheLimit:50,autoReconnect:!0}),bot.connect({token:Config.token}),bot.Dispatcher.on("GATEWAY_READY",e=>{console.log("Connected as: "+bot.User.username+"\n"+version)}),bot.Dispatcher.on("MESSAGE_CREATE",e=>{validate(e,reboottrigger,defaultsudo)&&(e.message.guild.name,e.message,process.exit())}),bot.Dispatcher.on("MESSAGE_CREATE",e=>{var n;validate(e,"-tryrun",defaultsudo)&&(e.message.guild.name,n=e.message,fs.writeFileSync("tempjs.js",command),require("child_process").exec("node tempjs.js",function(e,o,i){message=e||o,n.reply("Response:\n"+message)}))}),bot.Dispatcher.on("MESSAGE_CREATE",e=>{var n;if(validate(e,manifesttrigger,defaultsudo)){e.message.guild.name,n=e.message;var o=fs.readFileSync("./html.html","utf8"),i=n;n.delete(),nodeHtmlToImage({output:"./image.png",html:o}).then(()=>{console.log("OWO"),trimImage("./image.png","./image2.png",{},e=>e?(console.log(e),1):(console.log(1),0))}),setTimeout(function(){console.log(2),i.channel.uploadFile("image2.png","manifest.png")},5e3)}}),bot.Dispatcher.on("MESSAGE_CREATE",e=>{var n;if(validate(e,singlefaxtrigger,defaultsudo)){e.message.guild.name;var o=(n=e.message).content.split(singlefaxtrigger)[1].split(" ")[0].replace("*","").replace("*","").replace("*","").replace("*","").replace("*","").replace("*","");console.log(o);try{var i=fs.readFileSync(faxdir+o+".html","utf8")}catch(e){return console.log(e)}i=i.replace("ntlogo.png",logolink);var t=n;nodeHtmlToImage({output:"./image.png",html:i}).then(()=>{console.log("OWO"),trimImage("./image.png","./image2.png",{},e=>e?(console.log(e),1):(console.log(1),0))}),setTimeout(function(){if(console.log(2),t.channel.uploadFile("image2.png","singlefax.png"),publicfaxchannel&&i.includes("request: ")){switch(department=message.split("request: ")[1].split(" ")[0].split("\n")[0].split("<")[0],department){case"security":department=security;break;case"cargo":department=cargo;break;case"medical":department=medical;break;case"exploration":department=exploration;break;case"science":department=science;break;case"service":department=service;break;case"command":department=command;break;default:department=!1}department&&CMU(publicfaxchannel,department,"image2.png")}},5e3)}}),bot.Dispatcher.on("MESSAGE_CREATE",e=>{var n;if(validate(e,multifaxtrigger,defaultsudo)){e.message.guild.name;var o=(n=e.message).content.split(multifaxtrigger)[1].split("|");for(i=0;i<o.length;i++){let g=o[i];try{var t=fs.readFileSync(faxdir+g+".html","utf8")}catch(e){return console.log(e)}t=t.replace("ntlogo.png",logolink),console.log(t);var a=n;nodeHtmlToImage({output:"./"+g+".png",html:t}).then(()=>{console.log("OWO"),trimImage("./"+g+".png","./"+g+"2.png",{},e=>e?(console.log(e),1):(console.log(1),0))}),setTimeout(function(){console.log(2),a.channel.uploadFile(g+"2.png","multifax"+[i]+".png")},5e3)}}});
